- uses: actions/checkout@v4
- uses: actions/setup-node@v4
  with:
    node-version: 18

- name: Clean install
  run: |
    rm -f package-lock.json
    rm -rf node_modules tsconfig.json src/react-app-env.d.ts
    find src -type f \( -name "*.ts" -o -name "*.tsx" \) -delete
    npm cache clean --force
    npm install

- name: Verify ajv versions
  run: npm ls ajv ajv-keywords schema-utils || true

- name: Build
  run: npm run build

- name: SPA 404 fallback
  run: cp build/index.html build/404.html

- uses: actions/upload-pages-artifact@v3
  with:
    path: build
